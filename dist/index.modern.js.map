{"version":3,"file":"index.modern.js","sources":["../src/columns/textColumn.tsx","../src/columns/checkboxColumn.tsx","../src/columns/floatColumn.tsx","../src/columns/progressColumn.tsx","../src/contexts/DataSheetGridContext.tsx","../src/components/Row.tsx","../src/hooks/useScrollbarWidth.tsx","../src/hooks/useColumnWidths.tsx","../src/components/InnerContainer.tsx","../src/hooks/useGetBoundingRect.tsx","../src/hooks/useDocumentEventListener.tsx","../src/components/AddRowsCounter.tsx","../src/components/ContextMenu.tsx","../src/components/DataSheetGrid.tsx","../src/index.tsx"],"sourcesContent":["import * as React from 'react'\nimport { useLayoutEffect, useRef } from 'react'\nimport { Column } from '../typings'\n\nconst Component = ({ focus, onChange, value }) => {\n  const ref = useRef<HTMLInputElement>(null)\n\n  useLayoutEffect(() => {\n    if (focus) {\n      ref.current?.select()\n    } else {\n      ref.current?.blur()\n    }\n  }, [focus])\n\n  return (\n    <input\n      className='dsg-input'\n      ref={ref}\n      style={{ pointerEvents: focus ? 'auto' : 'none' }}\n      value={value || ''}\n      onChange={(e) => onChange(e.target.value || null)}\n    />\n  )\n}\n\nexport function textColumn<TRow = any>({\n  key,\n  ...rest\n}: Partial<Column<TRow>> & { key: string }): Partial<Column<TRow>> {\n  return {\n    render: ({ focus, rowData, setRowData }) => (\n      <Component\n        value={rowData[key]}\n        focus={focus}\n        onChange={(value) => setRowData({ ...rowData, [key]: value })}\n      />\n    ),\n    deleteValue: ({ rowData }) => ({ ...rowData, [key]: null }),\n    copyValue: ({ rowData }) => rowData[key],\n    pasteValue: ({ rowData, value }) => ({ ...rowData, [key]: value || null }),\n    ...rest,\n  }\n}\n","import * as React from 'react'\nimport { useLayoutEffect, useRef } from 'react'\nimport { Column } from '../typings'\n\nconst FALSY = [\n  '',\n  'false',\n  'no',\n  'off',\n  'disabled',\n  '0',\n  'n',\n  'f',\n  'unchecked',\n  'undefined',\n  'null',\n  'wrong',\n  'negative',\n]\n\nconst Component = ({ focus, active, onChange, value, done }) => {\n  const ref = useRef<HTMLInputElement>(null)\n\n  useLayoutEffect(() => {\n    if (focus) {\n      onChange(!value)\n      done({ nextRow: false })\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [focus, done])\n\n  return (\n    <input\n      className='dsg-checkbox'\n      type='checkbox'\n      ref={ref}\n      checked={Boolean(value)}\n      onMouseDown={() => !active && onChange(!value)}\n      onChange={() => null}\n    />\n  )\n}\n\nexport function checkboxColumn<TRow = any>({\n  key,\n  ...rest\n}: Partial<Column<TRow>> & { key: string }): Partial<Column<TRow>> {\n  return {\n    render: ({ focus, active, setRowData, rowData, done }) => (\n      <Component\n        value={rowData[key]}\n        focus={focus}\n        active={active}\n        done={done}\n        onChange={(value) => setRowData({ ...rowData, [key]: value })}\n      />\n    ),\n    deleteValue: ({ rowData }) => ({ ...rowData, [key]: false }),\n    copyValue: ({ rowData }) => (rowData[key] ? 'YES' : 'NO'),\n    pasteValue: ({ rowData, value }) => ({\n      ...rowData,\n      [key]: !FALSY.includes(value.toLowerCase()),\n    }),\n    ...rest,\n  }\n}\n","import * as React from 'react'\nimport { useEffect, useLayoutEffect, useRef, useState } from 'react'\nimport { Column } from '../typings'\n\nconst numberToString = (value: any): string =>\n  typeof value === 'number' && !isNaN(value) ? String(value) : ''\n\nconst Component = ({ focus, onChange, value, typeObj }) => {\n  const [rawValue, setRawValue] = useState<string>(numberToString(value))\n  const ref = useRef<HTMLInputElement>(null)\n\n  useLayoutEffect(() => {\n    if (focus) {\n      ref.current?.select()\n    } else {\n      ref.current?.blur()\n    }\n  }, [focus])\n\n  useEffect(() => {\n    if (!focus) {\n      setRawValue(numberToString(value))\n    }\n  }, [focus, value])\n\n  return (\n    <input\n      className='dsg-input dsg-input-align-right'\n      ref={ref}\n      style={{ pointerEvents: focus ? 'auto' : 'none' }}\n      value={rawValue ? rawValue === '0' ? '-' : Math.abs(Number(rawValue)) > 1000 ? Math.round(Number(rawValue)) : rawValue : '-'}\n      onChange={(e) => {\n        if(!typeObj?.includes('Formula')){\n          const targetValue = e.target.value\n          const number = parseFloat(targetValue)\n          setRawValue(targetValue)\n          onChange(!isNaN(number) && targetValue ? number : null)\n        }\n      }}\n    />\n  )\n}\n\nexport function floatColumn<TRow = any>({\n  key,\n  ...rest\n}: Partial<Column<TRow>> & { key: string }): Partial<Column<TRow>> {\n  return {\n\n    render: ({ focus, rowData, setRowData }) => (\n      <Component\n        typeObj={rowData?.['typeObj']}\n        value={rowData[key]}\n        focus={focus}\n        onChange={(value) => setRowData({ ...rowData, [key]: value })}\n      />\n    ),\n    deleteValue: ({ rowData }) => ({ ...rowData, [key]: null }),\n    copyValue: ({ rowData }) => rowData[key],\n    pasteValue: ({ rowData, value }) => {\n      const number = parseFloat(value)\n      return { ...rowData, [key]: !isNaN(number) ? number : null }\n    },\n    ...rest,\n  }\n}\n","import * as React from 'react'\nimport { useEffect, useLayoutEffect, useRef, useState } from 'react'\nimport { Column } from '../typings'\n\nconst numberToString = (value: any): string =>\n  typeof value === 'number' && !isNaN(value) ? String(value) : ''\n\nconst Component = ({ focus, onChange, value }) => {\n  const [rawValue, setRawValue] = useState<string>(numberToString(value * 100))\n  const ref = useRef<HTMLInputElement>(null)\n\n  useLayoutEffect(() => {\n    if (focus) {\n      ref.current?.select()\n    } else {\n      ref.current?.blur()\n    }\n  }, [focus])\n\n  useEffect(() => {\n    if (!focus) {\n      setRawValue(typeof value === 'number' ? numberToString(value * 100) : '')\n    }\n  }, [focus, value])\n\n  return (\n    <React.Fragment>\n      <input\n        className='dsg-input dsg-input-align-right'\n        ref={ref}\n        style={{ pointerEvents: focus ? 'auto' : 'none' }}\n        value={rawValue}\n        onChange={(e) => {\n          const targetValue = e.target.value\n          const number = parseFloat(targetValue)\n          setRawValue(targetValue)\n          onChange(\n            !isNaN(number) && targetValue\n              ? Math.min(100, Math.max(0, number)) / 100\n              : null\n          )\n        }}\n      />\n      <span className='dsg-input-suffix'>%</span>\n      <div className='dsg-input-progress-indicator' style={{ width: value * 100 + '%'}} />\n    </React.Fragment>\n  )\n}\n\nexport function progressColumn<TRow = any>({\n  key,\n  ...rest\n}: Partial<Column<TRow>> & { key: string }): Partial<Column<TRow>> {\n  return {\n    render: ({ focus, rowData, setRowData }) => (\n      <Component\n        value={rowData[key]}\n        focus={focus}\n        onChange={(value) => setRowData({ ...rowData, [key]: value })}\n      />\n    ),\n    deleteValue: ({ rowData }) => ({ ...rowData, [key]: null }),\n    copyValue: ({ rowData }) => typeof rowData[key] === 'number' ? rowData[key] * 100 + '%' : null,\n    pasteValue: ({ rowData, value }) => {\n      const number = parseFloat(value)\n      return {\n        ...rowData,\n        [key]: !isNaN(number) ? Math.min(100, Math.max(0, number)) / 100 : null,\n      }\n    },\n    ...rest,\n  }\n}\n","import * as React from 'react'\nimport { GridContext } from '../typings'\n\nexport const DataSheetGridContext = React.createContext<GridContext>({\n  focus: false,\n  activeCell: null,\n  headerRowHeight: 0,\n  rowHeight: 0,\n  columnWidths: [],\n  columnOffsets: [],\n  innerWidth: 0,\n  data: [],\n  columns: [],\n  selection: null,\n  editing: false,\n  onChange: () => null,\n  isCellDisabled: () => false,\n  onDoneEditing: () => undefined,\n  onInsertRowAfter: () => undefined,\n  onDuplicateRows: () => undefined,\n  onDeleteRows: () => undefined,\n})\n","import * as React from 'react'\nimport cx from 'classnames'\n\nimport { ListChildComponentProps } from 'react-window'\nimport { useContext } from 'react'\nimport { DataSheetGridContext } from '../contexts/DataSheetGridContext'\n\nexport const Row = React.memo(\n  ({ style, index: rowIndex }: ListChildComponentProps) => {\n    const {\n      innerWidth,\n      selection,\n      data,\n      columns,\n      activeCell,\n      editing,\n      onChange,\n      isCellDisabled,\n      onDoneEditing,\n      columnWidths,\n      columnOffsets,\n      rowHeight,\n      onInsertRowAfter,\n      onDuplicateRows,\n      onDeleteRows,\n    } = useContext(DataSheetGridContext)\n\n    const headerRow = rowIndex === 0\n\n    if (headerRow) {\n      return null\n    }\n\n    return (\n      <div\n        className={cx({\n          'dsg-row': true,\n        })}\n        style={{ ...style, width: `${innerWidth}px` }}\n      >\n        {columnWidths.map((width, columnIndex) => {\n          const gutterColumn = columnIndex === 0\n          const active =\n            activeCell?.col === columnIndex - 1 &&\n            activeCell.row === rowIndex - 1\n\n          const disabled = isCellDisabled({\n            col: columnIndex - 1,\n            row: rowIndex - 1,\n          })\n\n          return (\n            <div\n              key={columnIndex}\n              className={cx({\n                'dsg-cell': true,\n                'dsg-cell-disabled': !headerRow && disabled,\n                'dsg-cell-gutter': gutterColumn,\n                'dsg-cell-last-column': columnIndex === columns.length - 1,\n                'dsg-cell-last-row': rowIndex === data.length,\n                'dsg-cell-gutter-active':\n                  gutterColumn &&\n                  (activeCell?.row === rowIndex - 1 ||\n                    (selection &&\n                      rowIndex >= selection.min.row + 1 &&\n                      rowIndex <= selection.max.row + 1)),\n              })}\n              style={{\n                width: `${width}px`,\n                left: `${columnOffsets[columnIndex - 1] || 0}px`,\n                height: `${rowHeight}px`,\n                top: 0,\n              }}\n            >\n              {columns[columnIndex].render({\n                insertRowBelow: () => {\n                  onInsertRowAfter(rowIndex - 1)\n                },\n                duplicateRow: () => {\n                  onDuplicateRows(rowIndex - 1)\n                },\n                deleteRow: () => {\n                  onDeleteRows(rowIndex - 1)\n                },\n                active,\n                focus: active && editing,\n                rowIndex: rowIndex - 1,\n                rowData: data[rowIndex - 1],\n                columnIndex: columnIndex - 1,\n                done: onDoneEditing,\n                disabled,\n                setRowData: (rowData) =>\n                  onChange([\n                    ...data.slice(0, rowIndex - 1),\n                    rowData,\n                    ...data.slice(rowIndex),\n                  ]),\n              })}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\n","import { scrollbarWidth } from '@xobotyi/scrollbar-width'\nimport { useLayoutEffect, useState } from 'react'\n\nexport const useScrollbarWidth = () => {\n  const [width, setWidth] = useState<number | undefined>(scrollbarWidth())\n\n  useLayoutEffect(() => {\n    setTimeout(() => setWidth(scrollbarWidth()), 0)\n  }, [])\n\n  return width\n}\n","import { useEffect, useMemo, useState } from 'react'\nimport { useScrollbarWidth } from './useScrollbarWidth'\nimport { Column } from '../typings'\n\nexport const useColumnWidths = (\n  width: number,\n  columns: Column[],\n  includeScrollbar: boolean\n) => {\n  const scrollbarWidth = useScrollbarWidth()\n  const [widths, setWidths] = useState<number[] | null>(null)\n  const innerWidth = useMemo<number | null>(\n    () =>\n      widths &&\n      widths.reduce((total, w) => {\n        return total + w\n      }),\n    [widths]\n  )\n  const offsets = useMemo<number[] | null>(() => {\n    let total = 0\n    return (\n      widths &&\n      widths.map((w, i) => {\n        total += w\n        return i === widths.length - 1 ? Infinity : total\n      })\n    )\n  }, [widths])\n\n  const columnsHash = columns\n    .map(({ width, minWidth, maxWidth }) =>\n      [width, minWidth, maxWidth].join(',')\n    )\n    .join('|')\n\n  useEffect(() => {\n    if (scrollbarWidth !== undefined || !includeScrollbar) {\n      const el = document.createElement('div')\n\n      el.style.display = 'flex'\n      el.style.position = 'fixed'\n      el.style.width = `${\n        width - (includeScrollbar ? (scrollbarWidth as number) : 0)\n      }px`\n      el.style.left = '-999px'\n      el.style.top = '-1px'\n\n      const children = columns.map((column) => {\n        const child = document.createElement('div')\n\n        child.style.display = 'block'\n        child.style.flex = String(column.width)\n        child.style.minWidth = `${column.minWidth}px`\n        child.style.maxWidth = `${column.maxWidth}px`\n\n        return child\n      })\n\n      children.forEach((child) => el.appendChild(child))\n      document.body.insertBefore(el, null)\n\n      setWidths(children.map((child) => child.offsetWidth))\n      el.remove()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [width, columnsHash, scrollbarWidth, includeScrollbar])\n\n  return { widths, offsets, innerWidth }\n}\n","import * as React from 'react'\nimport { forwardRef, useContext, useMemo } from 'react'\nimport { DataSheetGridContext } from '../contexts/DataSheetGridContext'\nimport cx from 'classnames'\n\nconst buildSquare = (top, right, bottom, left) => {\n  return [\n    [left, top],\n    [right, top],\n    [right, bottom],\n    [left, bottom],\n    [left, top],\n  ]\n}\n\nconst buildClipPath = (top, right, bottom, left) => {\n  const values = [\n    ...buildSquare(0, '100%', '100%', 0),\n    ...buildSquare(top, right, bottom, left),\n  ]\n\n  return `polygon(evenodd, ${values\n    .map((pair) =>\n      pair\n        .map((value) =>\n          typeof value === 'number' && value !== 0 ? value + 'px' : value\n        )\n        .join(' ')\n    )\n    .join(',')})`\n}\n\nexport const InnerContainer = forwardRef<HTMLDivElement>(\n  ({ children, ...rest }, ref) => {\n    const {\n      activeCell,\n      columnWidths,\n      columnOffsets,\n      innerWidth,\n      rowHeight,\n      headerRowHeight,\n      selection,\n      data,\n      editing,\n      columns,\n      isCellDisabled,\n    } = useContext(DataSheetGridContext)\n\n    const extraPixelV = (rowI: number): number => {\n      return rowI < data.length - 1 ? 1 : 0\n    }\n\n    const extraPixelH = (colI: number): number => {\n      return colI < columns.length - 2 ? 1 : 0\n    }\n\n    const activeCellRect = activeCell && {\n      width: columnWidths[activeCell.col + 1] + extraPixelH(activeCell.col),\n      height: rowHeight + extraPixelV(activeCell.row),\n      left: columnWidths\n        .slice(0, activeCell.col + 1)\n        .reduce((a, b) => a + b, 0),\n      top: rowHeight * activeCell.row + headerRowHeight,\n    }\n\n    const selectionRect = selection && {\n      width: columnWidths\n        .slice(selection.min.col + 1, selection.max.col + 2)\n        .reduce((a, b) => a + b, extraPixelH(selection.max.col)),\n      height:\n        rowHeight * (selection.max.row - selection.min.row + 1) +\n        extraPixelV(selection.max.row),\n      left: columnWidths\n        .slice(0, selection.min.col + 1)\n        .reduce((a, b) => a + b, 0),\n      top: rowHeight * selection.min.row + headerRowHeight,\n    }\n\n    const selectionIsDisabled = useMemo(() => {\n      if (!selection) {\n        return false\n      }\n\n      for (let col = selection.min.col; col <= selection.max.col; ++col) {\n        for (let row = selection.min.row; row <= selection.max.row; ++row) {\n          if (!isCellDisabled({ col, row })) {\n            return false\n          }\n        }\n      }\n\n      return true\n    }, [isCellDisabled, selection])\n\n    return (\n      <div ref={ref} {...rest}>\n        <div\n          className={cx({\n            'dsg-header-row': true,\n          })}\n          style={{ height: `${headerRowHeight}px`, width: `${innerWidth}px` }}\n        >\n          {columnWidths.map((width, columnIndex) => {\n            const gutterColumn = columnIndex === 0\n\n            return (\n              <div\n                key={columnIndex}\n                className={cx({\n                  'dsg-cell': true,\n                  'dsg-cell-header': true,\n                  'dsg-cell-gutter': gutterColumn,\n                  'dsg-cell-last-column': columnIndex === columns.length - 1,\n                  'dsg-cell-header-active':\n                    activeCell?.col === columnIndex - 1 ||\n                    (selection &&\n                      columnIndex >= selection.min.col + 1 &&\n                      columnIndex <= selection.max.col + 1),\n                })}\n                style={{\n                  width: `${width}px`,\n                  left: `${columnOffsets[columnIndex - 1] || 0}px`,\n                  height: `${headerRowHeight}px`,\n                  top: 0,\n                }}\n              >\n                {columns[columnIndex].title}\n              </div>\n            )\n          })}\n        </div>\n        {children}\n        {activeCellRect && (\n          <div\n            className={cx({\n              'dsg-active-cell': true,\n              'dsg-active-cell-focus': editing,\n              'dsg-active-cell-disabled':\n                activeCell && isCellDisabled(activeCell),\n            })}\n            style={activeCellRect}\n          />\n        )}\n        {selectionRect && activeCellRect && (\n          <div\n            className={cx({\n              'dsg-selection-rect': true,\n              'dsg-selection-rect-disabled': selectionIsDisabled,\n            })}\n            style={{\n              ...selectionRect,\n              clipPath: buildClipPath(\n                activeCellRect.top - selectionRect.top,\n                activeCellRect.left - selectionRect.left,\n                activeCellRect.top + activeCellRect.height - selectionRect.top,\n                activeCellRect.left + activeCellRect.width - selectionRect.left\n              ),\n            }}\n          />\n        )}\n      </div>\n    )\n  }\n)\n","import { MutableRefObject, RefObject, useRef } from 'react'\nimport { throttle } from 'throttle-debounce'\n\nconst compute = (\n  resultRef: MutableRefObject<DOMRect | null>,\n  ref: RefObject<HTMLElement>\n) => {\n  resultRef.current = ref.current?.getBoundingClientRect() || null\n}\n\nconst throttledCompute = throttle(\n  200,\n  (\n    resultRef: MutableRefObject<DOMRect | null>,\n    ref: RefObject<HTMLElement>,\n    force: boolean = false\n  ) => {\n    if (force) {\n      compute(resultRef, ref)\n    } else {\n      setTimeout(() => compute(resultRef, ref), 0)\n    }\n  }\n)\n\n// Cache bounding rect in a ref and only recompute every 200ms\nexport const useGetBoundingRect = (ref: RefObject<HTMLElement>) => {\n  const boundingRect = useRef<DOMRect | null>(null)\n\n  return (force: boolean = false) => {\n    throttledCompute(boundingRect, ref, force)\n    return boundingRect.current\n  }\n}\n","import { useEffect } from 'react'\n\nexport const useDocumentEventListener = (type: string, listener) => {\n  useEffect(() => {\n    document.addEventListener(type, listener)\n\n    return () => {\n      document.removeEventListener(type, listener)\n    }\n  }, [listener, type])\n}\n","import * as React from 'react'\nimport { useState } from 'react'\nimport { CounterComponentProps } from '../typings'\n\nexport const AddRowsCounter = React.memo(\n  ({ addRows }: CounterComponentProps) => {\n    const [value, setValue] = useState<number>(1)\n    const [rawValue, setRawValue] = useState<string>(String(value))\n\n    return (\n      <button\n        className='dsg-add-row'\n        type='button'\n        onClick={(e) => {\n          // @ts-ignore\n          if (e.target.tagName !== 'INPUT') {\n            addRows(value)\n          }\n        }}\n      >\n        Add\n        <input\n          className='dsg-add-row-input'\n          value={rawValue}\n          onBlur={() => setRawValue(String(value))}\n          onChange={(e) => {\n            setRawValue(e.target.value)\n            setValue(Math.max(1, Math.round(parseInt(e.target.value) || 0)))\n          }}\n          onKeyPress={(event) => {\n            if (event.key === 'Enter') {\n              addRows(value)\n            }\n          }}\n        />\n        rows\n      </button>\n    )\n  }\n)\n","import * as React from 'react'\nimport { ContextMenuItem, ContextMenuProps } from '../typings'\nimport { useCallback, useRef } from 'react'\nimport { useDocumentEventListener } from '../hooks/useDocumentEventListener'\n\nconst renderItem = (item: ContextMenuItem) => {\n  if (item.type === 'DELETE_ROW') {\n    return 'Delete row'\n  }\n\n  if (item.type === 'DELETE_ROWS') {\n    return (\n      <React.Fragment>\n        Delete rows <b>{item.fromRow}</b> to <b>{item.toRow}</b>\n      </React.Fragment>\n    )\n  }\n\n  if (item.type === 'INSERT_ROW_BELLOW') {\n    return 'Insert row below'\n  }\n\n  if (item.type === 'DUPLICATE_ROW') {\n    return 'Duplicate row'\n  }\n\n  if (item.type === 'DUPLICATE_ROWS') {\n    return (\n      <React.Fragment>\n        Duplicate rows <b>{item.fromRow}</b> to <b>{item.toRow}</b>\n      </React.Fragment>\n    )\n  }\n\n  return item.type\n}\n\nexport const ContextMenu = ({\n  clientX,\n  clientY,\n  items,\n  close,\n}: ContextMenuProps) => {\n  const containerRef = useRef<HTMLDivElement>(null)\n\n  const onClickOutside = useCallback(\n    (event: MouseEvent) => {\n      const clickInside = containerRef.current?.contains(event.target as Node)\n\n      if (!clickInside) {\n        close()\n      }\n    },\n    [close]\n  )\n  useDocumentEventListener('mousedown', onClickOutside)\n\n  return (\n    <div\n      className='dsg-context-menu'\n      style={{ left: clientX + 'px', top: clientY + 'px' }}\n      ref={containerRef}\n    >\n      {items.map((item) => (\n        <div\n          key={item.type}\n          onClick={item.action}\n          className='dsg-context-menu-item'\n        >\n          {renderItem(item)}\n        </div>\n      ))}\n    </div>\n  )\n}\n","import * as React from 'react'\nimport {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\nimport { VariableSizeList } from 'react-window'\nimport { Row as RowComponent } from './Row'\n\nimport { useColumnWidths } from '../hooks/useColumnWidths'\nimport { InnerContainer } from './InnerContainer'\nimport { DataSheetGridContext } from '../contexts/DataSheetGridContext'\nimport { useGetBoundingRect } from '../hooks/useGetBoundingRect'\nimport { useDocumentEventListener } from '../hooks/useDocumentEventListener'\nimport deepEqual from 'fast-deep-equal'\nimport {\n  Cell,\n  Column,\n  ContextMenuItem,\n  DataSheetGridProps,\n  GridContext,\n} from '../typings'\nimport useResizeObserver from '@react-hook/resize-observer'\nimport { useScrollbarWidth } from '../hooks/useScrollbarWidth'\nimport { AddRowsCounter } from './AddRowsCounter'\nimport { ContextMenu } from './ContextMenu'\n\nconst DEFAULT_DATA = []\nconst DEFAULT_COLUMNS = []\nconst DEFAULT_CREATE_ROW = () => ({})\nconst DEFAULT_ON_CHANGE = () => null\nconst DEFAULT_DUPLICATE_ROW = ({ rowData }) => ({ ...rowData })\nconst DEFAULT_IS_ROW_EMPTY = ({ rowData }) =>\n  Object.values(rowData).every((value) => !value)\nconst DEFAULT_RENDER_GUTTER_COLUMN = ({ rowIndex }) => rowIndex + 1\n\nfunction setStateDeepEqual<T>(newValue: T | ((old: T) => T)) {\n  return (oldValue: T): T => {\n    const newVal =\n      // @ts-ignore\n      typeof newValue === 'function' ? newValue(oldValue) : newValue\n    return deepEqual(oldValue, newVal) ? oldValue : newVal\n  }\n}\n\nexport function DataSheetGrid<TRow = any>({\n  data = DEFAULT_DATA,\n  onChange = DEFAULT_ON_CHANGE,\n  columns: rawColumns = DEFAULT_COLUMNS,\n  height = 400,\n  rowHeight = 40,\n  headerRowHeight = rowHeight,\n  gutterColumnWidth = '0 0 40px',\n  createRow = DEFAULT_CREATE_ROW as () => TRow,\n  duplicateRow = DEFAULT_DUPLICATE_ROW,\n  isRowEmpty = DEFAULT_IS_ROW_EMPTY,\n  counterComponent = AddRowsCounter,\n  contextMenuComponent = ContextMenu,\n  autoAddRow = false,\n  lockRows = false,\n  disableContextMenu: disableContextMenuRaw = false,\n  renderGutterColumn = DEFAULT_RENDER_GUTTER_COLUMN,\n}: DataSheetGridProps<TRow>) {\n  const disableContextMenu = disableContextMenuRaw || lockRows\n\n  // Add gutter column\n  const columns = useMemo<Column[]>(\n    () =>\n      [\n        {\n          width: gutterColumnWidth,\n          minWidth: 0,\n          title: <div className='dsg-corner-indicator' />,\n          render: renderGutterColumn,\n        },\n        ...rawColumns,\n      ].map((column) => ({\n        width: 1,\n        minWidth: 100,\n        render: () => null,\n        disableKeys: false,\n        disabled: false,\n        keepFocus: false,\n        deleteValue: ({ rowData }) => rowData,\n        copyValue: () => null,\n        pasteValue: ({ rowData }) => rowData,\n        ...column,\n      })),\n    [gutterColumnWidth, rawColumns, renderGutterColumn]\n  )\n\n  // Outer width (including borders) of the outer container\n  const [width, setWidth] = useState<number>(0)\n\n  // Height of all rows (including header row)\n  const innerHeight = headerRowHeight + rowHeight * data.length\n\n  // True when the vertical scrollbar is visible\n  const verticalScrollBar = height < innerHeight\n\n  const {\n    widths: columnWidths,\n    offsets: columnOffsets,\n    innerWidth,\n  } = useColumnWidths(width - 1, columns, verticalScrollBar)\n\n  // True when the horizontal scrollbar is visible\n  const horizontalScrollBar = (innerWidth || 0) >= width\n\n  const scrollbarWidth = useScrollbarWidth() || 0\n\n  const listRef = useRef<VariableSizeList>(null)\n  const containerRef = useRef<HTMLElement>(null)\n  const outsideContainerRef = useRef<HTMLDivElement>(null)\n  const getContainerBoundingRect = useGetBoundingRect(containerRef)\n\n  // Recompute the width as outside container is resized\n  useLayoutEffect(() => {\n    setWidth(\n      (w) => outsideContainerRef.current?.getBoundingClientRect().width || w\n    )\n  }, [])\n  useResizeObserver(outsideContainerRef, (entry) =>\n    setWidth(entry.contentRect.width)\n  )\n\n  // True when the active cell is being edited\n  const [editing, setEditing] = useState(false)\n\n  // x,y coordinates of the right click\n  const [contextMenu, setContextMenu] = useState<{\n    x: number\n    y: number\n  } | null>(null)\n\n  // Items of the context menu\n  const [contextMenuItems, setContextMenuItems] = useState<ContextMenuItem[]>(\n    []\n  )\n\n  // Highlighted cell, null when not focused\n  const [activeCell, setActiveCell] = useState<Cell | null>(null)\n\n  // The selection cell and the active cell are the two corners of the selection, null when nothing is selected\n  const [selectionCell, setSelectionCell] = useState<Cell | null>(null)\n\n  // Behavior of the selection when the user drags the mouse around\n  const [selectionMode, setSelectionMode] = useState({\n    // True when the position of the cursor should impact the columns of the selection\n    columns: false,\n    // True when the position of the cursor should impact the rows of the selection\n    rows: false,\n    // True when the user is dragging the mouse around to select\n    active: false,\n  })\n\n  // Min and max of the current selection (rectangle defined by the active cell and the selection cell), null when nothing is selected\n  const selection = useMemo<{ min: Cell; max: Cell } | null>(\n    () =>\n      activeCell &&\n      selectionCell && {\n        min: {\n          col: Math.min(activeCell.col, selectionCell?.col),\n          row: Math.min(activeCell.row, selectionCell?.row),\n        },\n        max: {\n          col: Math.max(activeCell.col, selectionCell?.col),\n          row: Math.max(activeCell.row, selectionCell?.row),\n        },\n      },\n    [activeCell, selectionCell]\n  )\n\n  // Scroll to any given cell making sure it is in view\n  const scrollTo = useCallback(\n    (cell: Cell) => {\n      // Align top\n      const topMax = cell.row * rowHeight\n      // Align bottom\n      const topMin =\n        (cell.row + 1) * rowHeight +\n        headerRowHeight -\n        (listRef.current?.props.height as number) +\n        1\n      // @ts-ignore\n      const scrollTop = listRef.current?.state.scrollOffset as number\n\n      if (scrollTop > topMax) {\n        listRef.current?.scrollTo(topMax)\n      } else if (scrollTop < topMin) {\n        listRef.current?.scrollTo(topMin)\n      }\n\n      if (columnOffsets && columnWidths) {\n        // Align left\n        const leftMax = columnOffsets[cell.col] - columnOffsets[0]\n        // Align right\n        const leftMin =\n          columnOffsets[cell.col] + columnWidths[cell.col + 1] - width + 1\n\n        // @ts-ignore\n        const outerRef = listRef.current?._outerRef as HTMLElement\n        const scrollLeft = outerRef.scrollLeft\n\n        if (scrollLeft > leftMax) {\n          outerRef.scrollLeft = 0\n        } else if (scrollLeft < leftMin) {\n          outerRef.scrollLeft = 0\n        }\n      }\n    },\n    [rowHeight, headerRowHeight, columnOffsets, width, columnWidths]\n  )\n\n  // Scroll to the selectionCell cell when it changes\n  useEffect(() => {\n    if (selectionCell) {\n      scrollTo(selectionCell)\n    }\n  }, [selectionCell, scrollTo])\n\n  // Scroll to the active cell when it changes\n  useEffect(() => {\n    if (activeCell) {\n      scrollTo(activeCell)\n    }\n  }, [activeCell, scrollTo])\n\n  // Blur any element on focusing the grid\n  useEffect(() => {\n    if (activeCell !== null) {\n      ;(document.activeElement as HTMLElement).blur()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [activeCell !== null])\n\n  // Extract the coordinates of the cursor from a mouse event\n  const getCursorIndex = useCallback(\n    (event: MouseEvent, force: boolean = false): Cell | null => {\n      const boundingClientRect = getContainerBoundingRect(force)\n      const outsideBoundingClientRect =\n        force && outsideContainerRef.current?.getBoundingClientRect()\n\n      if (boundingClientRect && columnOffsets) {\n        let x = event.clientX - boundingClientRect.left\n        let y = event.clientY - boundingClientRect.top\n\n        if (outsideBoundingClientRect) {\n          if (\n            event.clientY - outsideBoundingClientRect.top <=\n            headerRowHeight\n          ) {\n            y = 0\n          }\n          if (\n            event.clientX - outsideBoundingClientRect.left <=\n            columnOffsets[0]\n          ) {\n            x = 0\n          }\n        }\n\n        return {\n          col: columnOffsets.findIndex((right) => x < right) - 1,\n          row: Math.min(\n            data.length - 1,\n            Math.max(-1, Math.floor((y - headerRowHeight) / rowHeight))\n          ),\n        }\n      }\n\n      return null\n    },\n    [\n      getContainerBoundingRect,\n      columnOffsets,\n      data.length,\n      headerRowHeight,\n      rowHeight,\n    ]\n  )\n\n  const isCellDisabled = useCallback(\n    (cell: Cell): boolean => {\n      const disabled = columns[cell.col + 1].disabled\n\n      return Boolean(\n        typeof disabled === 'function'\n          ? disabled({ rowData: data[cell.row] })\n          : disabled\n      )\n    },\n    [columns, data]\n  )\n\n  const onInsertRowAfter = useCallback(\n    (row: number, count = 1) => {\n      if (!createRow) {\n        return\n      }\n      setSelectionCell(null)\n      setEditing(false)\n\n      if (lockRows) {\n        return\n      }\n\n      onChange([\n        ...data.slice(0, row + 1),\n        ...new Array(count).fill(0).map(createRow),\n        ...data.slice(row + 1),\n      ])\n      setActiveCell(\n        setStateDeepEqual((a) => ({ col: a?.col || 0, row: row + count }))\n      )\n    },\n    [createRow, data, lockRows, onChange]\n  )\n\n  const onDoneEditing = useCallback(\n    ({ nextRow = true } = {}) => {\n      if (activeCell?.row === data.length - 1) {\n        if (nextRow && autoAddRow) {\n          onInsertRowAfter(activeCell.row)\n        } else {\n          setEditing(false)\n        }\n      } else {\n        setEditing(false)\n\n        if (nextRow) {\n          setActiveCell(setStateDeepEqual((a) => a && { ...a, row: a.row + 1 }))\n        }\n      }\n    },\n    [activeCell, autoAddRow, data.length, onInsertRowAfter]\n  )\n\n  const onDuplicateRows = useCallback(\n    (rowMin, rowMax = rowMin) => {\n      if (lockRows) {\n        return\n      }\n\n      onChange([\n        ...data.slice(0, rowMax + 1),\n        ...data\n          .slice(rowMin, rowMax + 1)\n          .map((rowData) => duplicateRow({ rowData })),\n        ...data.slice(rowMax + 1),\n      ])\n      setActiveCell(\n        setStateDeepEqual<Cell | null>({ col: 0, row: rowMax + 1 })\n      )\n      setSelectionCell(\n        setStateDeepEqual<Cell | null>({\n          col: columns.length - 2,\n          row: 2 * rowMax - rowMin + 1,\n        })\n      )\n      setEditing(false)\n    },\n    [columns.length, data, duplicateRow, lockRows, onChange]\n  )\n\n  const onDeleteRows = useCallback(\n    (rowMin, rowMax = rowMin) => {\n      if (lockRows) {\n        return\n      }\n\n      setEditing(false)\n      setActiveCell(\n        setStateDeepEqual((a) => {\n          const row = Math.min(data.length - 2 - rowMax + rowMin, rowMin)\n\n          if (row < 0) {\n            return null\n          }\n\n          return a && { ...a, row }\n        })\n      )\n      setSelectionCell(null)\n      onChange([...data.slice(0, rowMin), ...data.slice(rowMax + 1)])\n    },\n    [data, lockRows, onChange]\n  )\n\n  const onDelete = useCallback(() => {\n    if (!activeCell) {\n      return\n    }\n\n    const min: Cell = selection?.min || activeCell\n    const max: Cell = selection?.max || activeCell\n\n    if (\n      data\n        .slice(min.row, max.row + 1)\n        .every((rowData) => isRowEmpty({ rowData }))\n    ) {\n      onDeleteRows(min.row, max.row)\n      return\n    }\n\n    const newData = [...data]\n\n    for (let row = min.row; row <= max.row; ++row) {\n      for (let col = min.col; col <= max.col; ++col) {\n        if (!isCellDisabled({ col, row })) {\n          const { deleteValue = ({ rowData }) => rowData } = columns[col + 1]\n          newData[row] = deleteValue({ rowData: newData[row] })\n        }\n      }\n    }\n\n    if (deepEqual(newData, data)) {\n      setActiveCell(\n        setStateDeepEqual<Cell | null>({ col: 0, row: min.row })\n      )\n      setSelectionCell(\n        setStateDeepEqual<Cell | null>({\n          col: columns.length - 2,\n          row: max.row,\n        })\n      )\n      return\n    }\n\n    onChange(newData)\n  }, [\n    activeCell,\n    columns,\n    data,\n    isCellDisabled,\n    isRowEmpty,\n    onChange,\n    onDeleteRows,\n    selection,\n  ])\n\n  const onCopy = useCallback(\n    (event: ClipboardEvent) => {\n      if (!editing && activeCell) {\n        const copyData: Array<Array<number | string | null>> = []\n\n        const min: Cell = selection?.min || activeCell\n        const max: Cell = selection?.max || activeCell\n\n        for (let row = min.row; row <= max.row; ++row) {\n          copyData.push([])\n\n          for (let col = min.col; col <= max.col; ++col) {\n            const { copyValue = () => null } = columns[col + 1]\n            copyData[row - min.row].push(copyValue({ rowData: data[row] }))\n          }\n        }\n\n        event.clipboardData?.setData(\n          'text/plain',\n          copyData.map((row) => row.join('\\t')).join('\\n')\n        )\n        event.preventDefault()\n      }\n    },\n    [activeCell, columns, data, editing, selection]\n  )\n  useDocumentEventListener('copy', onCopy)\n\n  const onCut = useCallback(\n    (event: ClipboardEvent) => {\n      if (!editing && activeCell) {\n        onCopy(event)\n        onDelete()\n        event.preventDefault()\n      }\n    },\n    [activeCell, editing, onCopy, onDelete]\n  )\n  useDocumentEventListener('cut', onCut)\n\n  const onPaste = useCallback(\n    async (event: ClipboardEvent) => {\n      if (!editing && activeCell) {\n        const pasteData =\n          event.clipboardData\n            ?.getData('text')\n            .replace(/\\r/g, '')\n            .split('\\n')\n            .map((row) => row.split('\\t')) || []\n\n        const min: Cell = selection?.min || activeCell\n        const max: Cell = selection?.max || activeCell\n\n        // Paste single row\n        if (pasteData.length === 1) {\n          const newData = [...data]\n\n          for (\n            let columnIndex = 0;\n            columnIndex < pasteData[0].length;\n            columnIndex++\n          ) {\n            const pasteValue = columns[min.col + columnIndex + 1]?.pasteValue\n\n            if (pasteValue) {\n              for (let rowIndex = min.row; rowIndex <= max.row; rowIndex++) {\n                if (\n                  !isCellDisabled({ col: columnIndex + min.col, row: rowIndex })\n                ) {\n                  newData[rowIndex] = await pasteValue({\n                    rowData: newData[rowIndex],\n                    value: pasteData[0][columnIndex],\n                  })\n                }\n              }\n            }\n          }\n\n          onChange(newData)\n          setActiveCell(\n            setStateDeepEqual<Cell | null>({ col: min.col, row: min.row })\n          )\n          setSelectionCell(\n            setStateDeepEqual<Cell | null>({\n              col: min.col + pasteData[0].length - 1,\n              row: max.row,\n            })\n          )\n        } else {\n          // Paste multiple rows\n          let newData = [...data]\n          const missingRows = min.row + pasteData.length - data.length\n\n          if (missingRows > 0) {\n            if (!lockRows) {\n              newData = [\n                ...newData,\n                ...new Array(missingRows).fill(0).map(() => createRow()),\n              ]\n            } else {\n              pasteData.splice(pasteData.length - missingRows, missingRows)\n            }\n          }\n\n          for (\n            let columnIndex = 0;\n            columnIndex < pasteData[0].length &&\n            min.col + columnIndex < columns.length - 1;\n            columnIndex++\n          ) {\n            const pasteValue = columns[min.col + columnIndex + 1]?.pasteValue\n\n            if (pasteValue) {\n              for (let rowIndex = 0; rowIndex < pasteData.length; rowIndex++) {\n                if (\n                  !isCellDisabled({\n                    col: min.col + columnIndex,\n                    row: min.row + rowIndex,\n                  })\n                ) {\n                  newData[min.row + rowIndex] = await pasteValue({\n                    rowData: newData[min.row + rowIndex],\n                    value: pasteData[rowIndex][columnIndex],\n                  })\n                }\n              }\n            }\n          }\n\n          onChange(newData)\n          setActiveCell(\n            setStateDeepEqual<Cell | null>({ col: min.col, row: min.row })\n          )\n          setSelectionCell(\n            setStateDeepEqual<Cell | null>({\n              col: Math.min(\n                min.col + pasteData[0].length - 1,\n                columns.length - 2\n              ),\n              row: min.row + pasteData.length - 1,\n            })\n          )\n        }\n\n        event.preventDefault()\n      }\n    },\n    [\n      activeCell,\n      columns,\n      createRow,\n      data,\n      editing,\n      isCellDisabled,\n      lockRows,\n      onChange,\n      selection,\n    ]\n  )\n  useDocumentEventListener('paste', onPaste)\n\n  const onMouseMove = useCallback(\n    (event: MouseEvent) => {\n      if (selectionMode.active) {\n        const cursorIndex = getCursorIndex(event)\n\n        setSelectionCell(\n          setStateDeepEqual(\n            cursorIndex && {\n              col: selectionMode.columns\n                ? Math.max(0, cursorIndex.col)\n                : columns.length - 2,\n              row: selectionMode.rows\n                ? Math.max(0, cursorIndex.row)\n                : data.length - 1,\n            }\n          )\n        )\n        setEditing(false)\n      }\n    },\n    [getCursorIndex, selectionMode, columns.length, data.length]\n  )\n  useDocumentEventListener('mousemove', onMouseMove)\n\n  const onMouseDown = useCallback(\n    (event: MouseEvent) => {\n      const rightClick = event.button === 2\n      const clickInside =\n        containerRef.current?.contains(event.target as Node) || false\n      const cursorIndex = clickInside ? getCursorIndex(event, true) : null\n\n      if (contextMenuItems.length) {\n        return\n      }\n\n      if (\n        !clickInside &&\n        editing &&\n        activeCell &&\n        columns[activeCell.col + 1].keepFocus\n      ) {\n        return\n      }\n\n      const clickOnActiveCell =\n        cursorIndex &&\n        activeCell &&\n        activeCell.col === cursorIndex.col &&\n        activeCell.row === cursorIndex.row &&\n        !isCellDisabled(activeCell)\n\n      if (clickOnActiveCell && editing) {\n        return\n      }\n\n      const rightClickInSelection =\n        rightClick &&\n        selection &&\n        cursorIndex &&\n        cursorIndex.row >= selection.min.row &&\n        cursorIndex.row <= selection.max.row &&\n        cursorIndex.col >= selection.min.col &&\n        cursorIndex.col <= selection.max.col\n\n      const rightClickOnSelectedHeaders =\n        rightClick &&\n        selection &&\n        cursorIndex &&\n        cursorIndex.row === -1 &&\n        cursorIndex.col >= selection.min.col &&\n        cursorIndex.col <= selection.max.col\n\n      const rightClickOnSelectedGutter =\n        rightClick &&\n        selection &&\n        cursorIndex &&\n        cursorIndex.row >= selection.min.row &&\n        cursorIndex.row <= selection.max.row &&\n        cursorIndex.col === -1\n\n      if (rightClick && !disableContextMenu) {\n        setTimeout(\n          () => setContextMenu({ x: event.clientX, y: event.clientY }),\n          0\n        )\n      }\n\n      setEditing((clickOnActiveCell && !rightClick) || false)\n\n      setActiveCell(\n        setStateDeepEqual<Cell | null>(\n          cursorIndex && {\n            col:\n              (rightClickInSelection || rightClickOnSelectedHeaders) &&\n              activeCell\n                ? activeCell.col\n                : Math.max(0, cursorIndex.col),\n            row:\n              (rightClickInSelection || rightClickOnSelectedGutter) &&\n              activeCell\n                ? activeCell.row\n                : Math.max(0, cursorIndex.row),\n          }\n        )\n      )\n\n      if (cursorIndex && !rightClick) {\n        setSelectionMode(\n          setStateDeepEqual({\n            columns: cursorIndex.col !== -1,\n            rows: cursorIndex.row !== -1,\n            active: true as boolean,\n          })\n        )\n      }\n\n      if (!rightClickInSelection) {\n        if (cursorIndex?.col === -1 || cursorIndex?.row === -1) {\n          let col = cursorIndex.col\n          let row = cursorIndex.row\n\n          if (cursorIndex.col === -1) {\n            col = columns.length - 2\n          }\n\n          if (cursorIndex.row === -1) {\n            row = data.length - 1\n          }\n\n          if (rightClickOnSelectedHeaders && selectionCell) {\n            col = selectionCell.col\n          }\n\n          if (rightClickOnSelectedGutter && selectionCell) {\n            row = selectionCell.row\n          }\n\n          setSelectionCell(\n            setStateDeepEqual<Cell | null>({ col, row })\n          )\n        } else {\n          setSelectionCell(null)\n        }\n      }\n\n      if (clickInside) {\n        event.preventDefault()\n      }\n    },\n    [\n      disableContextMenu,\n      selectionCell,\n      getCursorIndex,\n      activeCell,\n      isCellDisabled,\n      editing,\n      columns,\n      data.length,\n      selection,\n      contextMenuItems.length,\n    ]\n  )\n  useDocumentEventListener('mousedown', onMouseDown)\n\n  const onMouseUp = useCallback(() => {\n    setSelectionMode(\n      setStateDeepEqual({\n        columns: false as boolean,\n        rows: false as boolean,\n        active: false as boolean,\n      })\n    )\n  }, [])\n  useDocumentEventListener('mouseup', onMouseUp)\n\n  const onContextMenu = useCallback(\n    (event: MouseEvent) => {\n      const clickInside =\n        containerRef.current?.contains(event.target as Node) || false\n\n      const cursorIndex = clickInside ? getCursorIndex(event, true) : null\n\n      const clickOnActiveCell =\n        cursorIndex &&\n        activeCell &&\n        activeCell.col === cursorIndex.col &&\n        activeCell.row === cursorIndex.row &&\n        editing\n\n      if (clickInside && !clickOnActiveCell) {\n        event.preventDefault()\n      }\n    },\n    [getCursorIndex, activeCell, editing]\n  )\n  useDocumentEventListener('contextmenu', onContextMenu)\n\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (!activeCell) {\n        return\n      }\n\n      if (event.key.startsWith('Arrow') || event.key === 'Tab') {\n        if (editing && columns[activeCell.col + 1].disableKeys) {\n          return\n        }\n\n        if (editing && ['ArrowLeft', 'ArrowRight'].includes(event.key)) {\n          return\n        }\n\n        const add = (\n          [x, y]: [number, number],\n          cell: Cell | null\n        ): Cell | null =>\n          cell && {\n            col: Math.max(0, Math.min(columns.length - 2, cell.col + x)),\n            row: Math.max(0, Math.min(data.length - 1, cell.row + y)),\n          }\n\n        if (event.key === 'Tab' && event.shiftKey) {\n          setActiveCell(setStateDeepEqual((cell) => add([-1, 0], cell)))\n          setSelectionCell(null)\n        } else {\n          const direction = {\n            ArrowDown: [0, 1],\n            ArrowUp: [0, -1],\n            ArrowLeft: [-1, 0],\n            ArrowRight: [1, 0],\n            Tab: [1, 0],\n          }[event.key]\n\n          if (event.ctrlKey || event.metaKey) {\n            direction[0] *= columns.length\n            direction[1] *= data.length\n          }\n\n          if (event.shiftKey) {\n            setSelectionCell(\n              setStateDeepEqual((cell) => add(direction, cell || activeCell))\n            )\n          } else {\n            setActiveCell(setStateDeepEqual((cell) => add(direction, cell)))\n            setSelectionCell(null)\n          }\n        }\n        setEditing(false)\n\n        event.preventDefault()\n      } else if (event.key === 'Escape') {\n        if (!editing && !selectionCell) {\n          setActiveCell(null)\n        }\n\n        setSelectionCell(null)\n        setEditing(false)\n      } else if (\n        event.key === 'Enter' &&\n        !event.ctrlKey &&\n        !event.metaKey &&\n        !event.altKey &&\n        !event.shiftKey\n      ) {\n        setSelectionCell(null)\n\n        if (editing) {\n          if (!columns[activeCell.col + 1].disableKeys) {\n            onDoneEditing()\n          }\n        } else if (!isCellDisabled(activeCell)) {\n          setEditing(true)\n          scrollTo(activeCell)\n        }\n      } else if (\n        event.key === 'Enter' &&\n        !event.ctrlKey &&\n        !event.metaKey &&\n        !event.altKey &&\n        event.shiftKey\n      ) {\n        onInsertRowAfter(selection?.max.row || activeCell.row)\n      } else if (\n        event.key === 'd' &&\n        (event.ctrlKey || event.metaKey) &&\n        !event.altKey &&\n        !event.shiftKey\n      ) {\n        onDuplicateRows(\n          selection?.min.row || activeCell.row,\n          selection?.max.row\n        )\n        event.preventDefault()\n      } else if (\n        event.key.match(/^[a-zA-Z0-9 ,.+-]$/) &&\n        !event.ctrlKey &&\n        !event.metaKey &&\n        !event.altKey\n      ) {\n        if (!editing && !isCellDisabled(activeCell)) {\n          setSelectionCell(null)\n          setEditing(true)\n          scrollTo(activeCell)\n        }\n      } else if (['Backspace', 'Delete'].includes(event.key)) {\n        if (!editing) {\n          onDelete()\n          event.preventDefault()\n        }\n      } else if (event.key === 'a' && (event.ctrlKey || event.metaKey)) {\n        if (!editing) {\n          setActiveCell(\n            setStateDeepEqual<Cell | null>({ col: 0, row: 0 })\n          )\n          setSelectionCell(\n            setStateDeepEqual<Cell | null>({\n              col: columns.length - 2,\n              row: data.length - 1,\n            })\n          )\n          event.preventDefault()\n        }\n      }\n    },\n    [\n      scrollTo,\n      activeCell,\n      columns,\n      data.length,\n      editing,\n      isCellDisabled,\n      onDelete,\n      onDoneEditing,\n      onDuplicateRows,\n      onInsertRowAfter,\n      selection,\n      selectionCell,\n    ]\n  )\n  useDocumentEventListener('keydown', onKeyDown)\n\n  useEffect(() => {\n    if (!contextMenu && contextMenuItems.length) {\n      setContextMenuItems([])\n    }\n\n    if (contextMenu && !contextMenuItems.length) {\n      const items: ContextMenuItem[] = []\n\n      if (selection) {\n        items.push({\n          type: 'INSERT_ROW_BELLOW',\n          action: () => {\n            setContextMenu(null)\n            onInsertRowAfter(selection.max.row)\n          },\n        })\n      } else if (activeCell) {\n        items.push({\n          type: 'INSERT_ROW_BELLOW',\n          action: () => {\n            setContextMenu(null)\n            onInsertRowAfter(activeCell.row)\n          },\n        })\n      }\n\n      if (selection && selection.min.row !== selection.max.row) {\n        items.push({\n          type: 'DUPLICATE_ROWS',\n          fromRow: selection.min.row + 1,\n          toRow: selection.max.row + 1,\n          action: () => {\n            setContextMenu(null)\n            onDuplicateRows(selection.min.row, selection.max.row)\n          },\n        })\n      } else if (activeCell) {\n        items.push({\n          type: 'DUPLICATE_ROW',\n          action: () => {\n            setContextMenu(null)\n            onDuplicateRows(activeCell.row)\n          },\n        })\n      }\n\n      if (selection && selection.min.row !== selection.max.row) {\n        items.push({\n          type: 'DELETE_ROWS',\n          fromRow: selection.min.row + 1,\n          toRow: selection.max.row + 1,\n          action: () => {\n            setContextMenu(null)\n            onDeleteRows(selection.min.row, selection.max.row)\n          },\n        })\n      } else if (activeCell) {\n        items.push({\n          type: 'DELETE_ROW',\n          action: () => {\n            setContextMenu(null)\n            onDeleteRows(activeCell.row)\n          },\n        })\n      }\n\n      if (items.length) {\n        setContextMenuItems(items)\n      } else {\n        setContextMenu(null)\n      }\n    }\n  }, [\n    contextMenu,\n    selection,\n    onInsertRowAfter,\n    onDeleteRows,\n    onDuplicateRows,\n    contextMenuItems.length,\n    activeCell,\n  ])\n\n  const ContextMenuComponent = contextMenuComponent\n\n  // Counter components and props\n  const CounterComponent = counterComponent\n\n  const counterAddRows = useCallback(\n    (batchSize: number = 1) =>\n      onInsertRowAfter(\n        data?.length - 1,\n        Math.max(1, Math.round(Number(batchSize)))\n      ),\n    [data?.length, onInsertRowAfter]\n  )\n\n  // Grid context\n  const focus = Boolean(activeCell)\n  const gridContext = useMemo<GridContext>(\n    () => ({\n      focus: focus,\n      editing,\n      activeCell: activeCell,\n      columnWidths: columnWidths || columns.map(() => 0),\n      columnOffsets: columnOffsets || columns.map(() => 0),\n      innerWidth: innerWidth || 0,\n      rowHeight,\n      headerRowHeight,\n      selection,\n      columns,\n      data,\n      onChange,\n      onDoneEditing,\n      isCellDisabled,\n      onInsertRowAfter,\n      onDuplicateRows,\n      onDeleteRows,\n    }),\n    [\n      focus,\n      editing,\n      activeCell,\n      columnWidths,\n      columnOffsets,\n      innerWidth,\n      rowHeight,\n      headerRowHeight,\n      selection,\n      columns,\n      data,\n      onChange,\n      onDoneEditing,\n      isCellDisabled,\n      onInsertRowAfter,\n      onDuplicateRows,\n      onDeleteRows,\n    ]\n  )\n\n  return (\n    <DataSheetGridContext.Provider value={gridContext}>\n      <div ref={outsideContainerRef}>\n        <VariableSizeList\n          ref={listRef}\n          innerRef={containerRef}\n          innerElementType={InnerContainer}\n          estimatedItemSize={rowHeight}\n          itemSize={(i) => (i === 0 ? headerRowHeight : rowHeight)}\n          height={Math.min(\n            height,\n            innerHeight + (horizontalScrollBar ? scrollbarWidth : 0) + 1\n          )}\n          itemCount={(columnWidths && data.length + 1) || 0}\n          className='dsg-container'\n          width='100%'\n          children={RowComponent}\n        />\n\n        {createRow && !lockRows && (\n          <CounterComponent addRows={counterAddRows} />\n        )}\n\n        {contextMenu && contextMenuItems.length > 0 && (\n          <ContextMenuComponent\n            clientX={contextMenu.x}\n            clientY={contextMenu.y}\n            items={contextMenuItems}\n            close={() => setContextMenu(null)}\n          />\n        )}\n      </div>\n    </DataSheetGridContext.Provider>\n  )\n}\n","import { textColumn } from './columns/textColumn'\nimport { checkboxColumn } from './columns/checkboxColumn'\nimport { floatColumn } from './columns/floatColumn'\nimport { progressColumn } from './columns/progressColumn'\nimport { DataSheetGrid } from './components/DataSheetGrid'\nimport './styles.css'\n\nexport { DataSheetGrid, textColumn, checkboxColumn, floatColumn, progressColumn }\nexport default { DataSheetGrid, textColumn, checkboxColumn, floatColumn, progressColumn }\n"],"names":["Component","focus","onChange","value","ref","useRef","useLayoutEffect","current","select","blur","React","className","style","pointerEvents","e","target","textColumn","key","rest","render","rowData","setRowData","deleteValue","copyValue","pasteValue","FALSY","active","done","nextRow","type","checked","Boolean","onMouseDown","checkboxColumn","includes","toLowerCase","numberToString","isNaN","String","typeObj","rawValue","setRawValue","useState","useEffect","Math","abs","Number","round","targetValue","number","parseFloat","floatColumn","min","max","width","progressColumn","DataSheetGridContext","activeCell","headerRowHeight","rowHeight","columnWidths","columnOffsets","innerWidth","data","columns","selection","editing","isCellDisabled","onDoneEditing","undefined","onInsertRowAfter","onDuplicateRows","onDeleteRows","Row","index","rowIndex","useContext","headerRow","cx","map","columnIndex","gutterColumn","col","row","disabled","length","left","height","top","insertRowBelow","duplicateRow","deleteRow","slice","useScrollbarWidth","setWidth","scrollbarWidth","setTimeout","useColumnWidths","includeScrollbar","widths","setWidths","useMemo","reduce","total","w","offsets","i","Infinity","columnsHash","minWidth","maxWidth","join","el","document","createElement","display","position","children","column","child","flex","forEach","appendChild","body","insertBefore","offsetWidth","remove","buildSquare","right","bottom","buildClipPath","values","pair","InnerContainer","forwardRef","extraPixelV","rowI","extraPixelH","colI","activeCellRect","a","b","selectionRect","selectionIsDisabled","title","clipPath","compute","resultRef","getBoundingClientRect","throttledCompute","throttle","force","useGetBoundingRect","boundingRect","useDocumentEventListener","listener","addEventListener","removeEventListener","AddRowsCounter","addRows","setValue","onClick","tagName","onBlur","parseInt","onKeyPress","event","renderItem","item","fromRow","toRow","ContextMenu","clientX","clientY","items","close","containerRef","onClickOutside","useCallback","clickInside","contains","action","DEFAULT_DATA","DEFAULT_COLUMNS","DEFAULT_CREATE_ROW","DEFAULT_ON_CHANGE","DEFAULT_DUPLICATE_ROW","DEFAULT_IS_ROW_EMPTY","Object","every","DEFAULT_RENDER_GUTTER_COLUMN","setStateDeepEqual","newValue","oldValue","newVal","deepEqual","DataSheetGrid","rawColumns","gutterColumnWidth","createRow","isRowEmpty","counterComponent","contextMenuComponent","autoAddRow","lockRows","disableContextMenu","disableContextMenuRaw","renderGutterColumn","disableKeys","keepFocus","innerHeight","verticalScrollBar","horizontalScrollBar","listRef","outsideContainerRef","getContainerBoundingRect","useResizeObserver","entry","contentRect","setEditing","contextMenu","setContextMenu","contextMenuItems","setContextMenuItems","setActiveCell","selectionCell","setSelectionCell","selectionMode","setSelectionMode","rows","scrollTo","cell","topMax","topMin","props","scrollTop","state","scrollOffset","leftMax","leftMin","outerRef","_outerRef","scrollLeft","activeElement","getCursorIndex","boundingClientRect","outsideBoundingClientRect","x","y","findIndex","floor","count","Array","fill","rowMin","rowMax","onDelete","newData","onCopy","copyData","push","clipboardData","setData","preventDefault","onCut","onPaste","pasteData","getData","replace","split","missingRows","splice","onMouseMove","cursorIndex","rightClick","button","clickOnActiveCell","rightClickInSelection","rightClickOnSelectedHeaders","rightClickOnSelectedGutter","onMouseUp","onContextMenu","onKeyDown","startsWith","add","shiftKey","direction","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Tab","ctrlKey","metaKey","altKey","match","ContextMenuComponent","CounterComponent","counterAddRows","batchSize","gridContext","Provider","VariableSizeList","innerRef","innerElementType","estimatedItemSize","itemSize","itemCount","RowComponent"],"mappings":"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"}